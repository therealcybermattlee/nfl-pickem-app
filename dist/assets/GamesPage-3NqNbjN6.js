import{j as e}from"./index-ww_31RWK.js";import{r as d}from"./vendor-DLdglawL.js";import{A as z}from"./api-9Tv9JkjW.js";const P=s=>{const a=typeof s=="string"?new Date(s):s;return Math.max(0,Math.floor((a.getTime()-Date.now())/1e3))},W=s=>{const a=Math.floor(s/3600),r=Math.floor(s%3600/60),m=s%60;return a>0?[a,r,m].map(l=>l<10?`0${l}`:l).join(":"):[r,m].map(l=>l<10?`0${l}`:l).join(":")},G=s=>{const a=Math.floor(s/3600),r=Math.floor(s%3600/60);return a>0?`${a}h ${r}m`:`${r}m`},O=(s,a=0)=>{const r=typeof s=="string"?new Date(s):s,m=new Date(r.getTime()-a*60*1e3);return Date.now()>=m.getTime()},F=(s,a=0)=>{const r=typeof s=="string"?new Date(s):s;return new Date(r.getTime()-a*60*1e3)},H=s=>(typeof s=="string"?new Date(s):s).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",timeZoneName:"short"}),V=(s,a=!1)=>{const r=typeof s=="string"?new Date(s):s,m=r.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});if(a){const l=H(r);return`${m} at ${l}`}return m},J=(s,a=0)=>O(s,a)?"This game is locked for picks. Submission deadline has passed.":null,M=({targetTime:s,mode:a="detailed",onFinish:r,className:m="",showIcon:l=!1,urgentThreshold:u=300})=>{const[x,f]=d.useState(P(s)),[o,p]=d.useState(!1),g=d.useCallback(()=>{const n=P(s);f(n),n<=0&&!o&&(p(!0),r==null||r())},[s,r,o]);d.useEffect(()=>{g();const n=setInterval(g,1e3);return()=>clearInterval(n)},[g]);const v=x>0&&x<=u,C=x<=0,N=()=>{if(C)return a==="minimal"?"0:00":"Expired";switch(a){case"compact":return G(x);case"minimal":return W(x);case"detailed":default:return W(x)}},S=()=>{let n="font-mono font-medium transition-colors duration-300";switch(C?n+=" text-red-600":v?n+=" text-orange-600 animate-pulse":n+=" text-gray-700",a){case"minimal":n+=" text-sm";break;case"compact":n+=" text-base";break;case"detailed":default:n+=" text-lg";break}return n},j=()=>e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),b=()=>{if(C)return"Time expired";const n=Math.floor(x/3600),y=Math.floor(x%3600/60),L=x%60;let w="";return n>0&&(w+=`${n} hour${n!==1?"s":""} `),y>0&&(w+=`${y} minute${y!==1?"s":""} `),n===0&&(w+=`${L} second${L!==1?"s":""} `),`${w.trim()} remaining`};return e.jsxs("div",{className:`inline-flex items-center ${m}`,role:"timer","aria-live":"assertive","aria-atomic":"true","aria-label":b(),children:[l&&e.jsx(j,{}),e.jsx("span",{className:S(),children:N()}),a==="detailed"&&!C&&e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:v?"remaining!":"left"})]})},Y={upcoming:{label:"OPEN",bgColor:"bg-blue-100",textColor:"text-blue-800",borderColor:"border-blue-200",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),description:"Picks are still open"},locked:{label:"LOCKED",bgColor:"bg-gray-100",textColor:"text-gray-800",borderColor:"border-gray-300",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),description:"No more picks allowed"},inProgress:{label:"LIVE",bgColor:"bg-orange-100",textColor:"text-orange-800",borderColor:"border-orange-200",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-7 4h12l-1 1H7l-1-1z"})}),description:"Game in progress"},final:{label:"FINAL",bgColor:"bg-green-100",textColor:"text-green-800",borderColor:"border-green-200",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),description:"Game completed"}},_={small:{container:"px-2 py-1 text-xs",icon:"w-3 h-3"},medium:{container:"px-3 py-1.5 text-sm",icon:"w-4 h-4"},large:{container:"px-4 py-2 text-base",icon:"w-5 h-5"}},R=({status:s,size:a="medium",showIcon:r=!1,className:m=""})=>{const l=Y[s],u=_[a];return e.jsxs("span",{className:`
        inline-flex items-center gap-1.5 rounded-full font-medium border transition-all duration-200
        ${l.bgColor} ${l.textColor} ${l.borderColor}
        ${u.container}
        ${m}
      `,role:"status","aria-label":l.description,title:l.description,children:[r&&e.jsx("span",{className:u.icon,"aria-hidden":"true",children:l.icon}),e.jsx("span",{children:l.label})]})},K=(s,a,r=0)=>{const m=typeof s=="string"?new Date(s):s,l=Date.now(),u=m.getTime(),x=u-r*60*1e3;return a?"final":l>=u?"inProgress":l>=x?"locked":"upcoming"},Z=({deadline:s,gameId:a,userHasPick:r=!1,isAutoPickEnabled:m=!1,onDeadlineReached:l,className:u="",compact:x=!1})=>{const[f,o]=d.useState(P(s)<=0);return d.useEffect(()=>{const p=()=>{P(s)<=0&&!f&&(o(!0),l==null||l(a))};p();const g=setInterval(p,1e3);return()=>clearInterval(g)},[s,a,f,l]),J(s),f?r?e.jsx("div",{className:`flex items-center space-x-2 ${u}`,children:e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm font-medium",children:"Pick submitted"})]})}):m?e.jsx("div",{className:`flex items-center space-x-2 ${u}`,children:e.jsxs("div",{className:"flex items-center text-orange-600",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm font-medium",children:"Auto-pick will be assigned"})]})}):e.jsx("div",{className:`flex items-center space-x-2 ${u}`,children:e.jsxs("div",{className:"flex items-center text-red-600",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.664-.833-2.464 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"text-sm font-medium",children:"Deadline passed"})]})}):r?e.jsxs("div",{className:`flex items-center space-x-2 ${u}`,children:[e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm font-medium",children:"Pick submitted"})]}),!x&&e.jsx("div",{className:"text-xs text-gray-500",children:"Can change until deadline"})]}):e.jsxs("div",{className:`space-y-2 ${u}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`font-medium ${x?"text-sm":"text-base"} text-gray-700`,children:"Pick deadline"}),e.jsx(M,{targetTime:s,mode:x?"compact":"detailed",urgentThreshold:300,className:"bg-orange-50 px-2 py-1 rounded"})]}),!x&&e.jsx("div",{className:"text-xs text-gray-500",children:m?"Submit your pick or one will be assigned automatically":"Submit your pick before time expires"})]})},q=({games:s,onDeadlineReached:a,className:r})=>{const m=s.filter(u=>P(u.deadline)>0),l=m.reduce((u,x)=>new Date(x.deadline).getTime()<u.getTime()?new Date(x.deadline):u,new Date(Date.now()+7*24*60*60*1e3));return m.length===0?e.jsx("div",{className:`text-center p-4 text-gray-500 ${r}`,children:"All pick deadlines have passed"}):e.jsxs("div",{className:`bg-gradient-to-r from-blue-50 to-orange-50 p-4 rounded-lg ${r}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Next deadline in:"}),e.jsx(M,{targetTime:l,mode:"compact",urgentThreshold:900})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[m.length," game",m.length!==1?"s":""," with pending picks"]})]})},Q=(s,a=!0)=>{const r=Math.abs(s)/100;return`${s>0?"+":"-"}${r.toFixed(1)}`},X=s=>(Math.abs(s)/100).toFixed(1),ee=({game:s,userHasPick:a=!1,userPickTeamId:r,onPickSubmit:m,onViewPick:l,className:u="",lockOffsetMinutes:x=0,isAutoPickEnabled:f=!1,compactMode:o=!1})=>{var b;const p="isLocked"in s,g=p?s:null,v=K(s.gameDate,s.isCompleted,x),C=g!=null&&g.lockTime?new Date(g.lockTime):F(s.gameDate,x),N=p?!(g!=null&&g.isLocked)&&!s.isCompleted:v==="upcoming",S=({team:n,isHome:y,score:L})=>e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`
        ${o?"w-12 h-12":"w-16 h-16"} 
        bg-primary/10 rounded-full flex items-center justify-center mb-2 overflow-hidden
        ${r===(n==null?void 0:n.id)?"ring-2 ring-blue-500 bg-blue-50":""}
      `,children:[n!=null&&n.logo?e.jsx("img",{src:n.logo,alt:`${n.name} logo`,className:`${o?"w-8 h-8":"w-12 h-12"} object-contain`,onError:w=>{w.currentTarget.style.display="none",w.currentTarget.nextElementSibling.style.display="block"}}):null,e.jsx("span",{className:`font-bold ${o?"text-sm":"text-lg"} text-primary ${n!=null&&n.logo?"hidden":""}`,style:{display:n!=null&&n.logo?"none":"block"},children:(n==null?void 0:n.abbreviation)||(y?"HOME":"AWAY")})]}),e.jsx("div",{className:`font-semibold ${o?"text-sm":"text-base"}`,children:o?n==null?void 0:n.abbreviation:(n==null?void 0:n.name)||`${y?"Home":"Away"} Team`}),!o&&e.jsx("div",{className:"text-sm text-muted-foreground",children:n==null?void 0:n.abbreviation}),L!=null&&e.jsx("div",{className:`${o?"text-xl":"text-2xl"} font-bold mt-2`,children:L}),r===(n==null?void 0:n.id)&&e.jsx("div",{className:"mt-1",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Your Pick"]})})]}),j=()=>!N||!m?null:e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>m(s.id,s.awayTeam.id),disabled:r===s.awayTeam.id,className:`
            px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 touch-manipulation
            ${r===s.awayTeam.id?"bg-blue-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-blue-50 hover:text-blue-700 active:scale-95"}
          `,children:["Pick ",s.awayTeam.abbreviation]}),e.jsxs("button",{onClick:()=>m(s.id,s.homeTeam.id),disabled:r===s.homeTeam.id,className:`
            px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 touch-manipulation
            ${r===s.homeTeam.id?"bg-blue-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-blue-50 hover:text-blue-700 active:scale-95"}
          `,children:["Pick ",s.homeTeam.abbreviation]})]});return e.jsxs("div",{className:`
      bg-white rounded-lg border shadow-sm hover:shadow-md transition-all duration-200
      ${o?"p-4":"p-6"}
      ${u}
    `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:`text-muted-foreground ${o?"text-xs":"text-sm"}`,children:["Game #",s.id," • Week ",s.week]}),!o&&e.jsx("div",{className:"text-sm font-medium text-gray-700",children:V(s.gameDate,!0)})]}),e.jsxs("div",{className:"flex flex-col items-end space-y-2",children:[e.jsx(R,{status:v,size:o?"small":"medium",showIcon:!o}),N&&e.jsx(M,{targetTime:(g==null?void 0:g.lockTime)||s.gameDate,mode:o?"compact":"detailed",className:"text-right"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(S,{team:s.awayTeam,isHome:!1,score:s.awayScore}),e.jsx("div",{className:`${o?"text-xl":"text-2xl"} font-bold text-muted-foreground`,children:"@"}),e.jsx(S,{team:s.homeTeam,isHome:!0,score:s.homeScore})]}),(s.homeSpread||s.overUnder)&&!o&&e.jsxs("div",{className:"flex justify-center space-x-4 mb-4 text-sm text-gray-600",children:[s.homeSpread&&e.jsxs("div",{children:[(b=s.homeTeam)==null?void 0:b.abbreviation," ",Q(s.homeSpread)]}),s.overUnder&&e.jsxs("div",{children:["O/U: ",X(s.overUnder)]})]}),v==="upcoming"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(Z,{deadline:C,gameId:s.id,userHasPick:a,isAutoPickEnabled:f,compact:o}),e.jsx(j,{})]}),(v==="locked"||v==="inProgress"||v==="final")&&a&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-green-700",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-sm font-medium",children:["Pick submitted: ",r===s.homeTeam.id?s.homeTeam.name:s.awayTeam.name]})]}),l&&e.jsx("button",{onClick:()=>l(s.id),className:"text-green-600 text-sm hover:text-green-800 transition-colors",children:"View"})]})}),v==="locked"&&!a&&f&&e.jsx("div",{className:"mt-4 p-3 bg-orange-50 rounded-lg border border-orange-200",children:e.jsxs("div",{className:"flex items-center text-orange-700",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm",children:"Auto-pick will be assigned"})]})})]})};function se(s={}){const{userId:a,authToken:r,fallbackToPolling:m=!0,pollingInterval:l=5e3,reconnectInterval:u=3e3,maxReconnectAttempts:x=5}=s,[f,o]=d.useState({events:[],isConnected:!1,isReconnecting:!1,lastEventId:0}),p=d.useRef(null),g=d.useRef(null),v=d.useRef(null),C=d.useRef(0),N=d.useRef(!0),S="https://nfl-pickem-app-production.cybermattlee-llc.workers.dev",j=d.useCallback(()=>{p.current&&(p.current.close(),p.current=null),g.current&&(clearTimeout(g.current),g.current=null),v.current&&(clearTimeout(v.current),v.current=null)},[]),b=d.useCallback(i=>{N.current&&o(c=>({...c,events:[...c.events,i],lastEventId:Math.max(c.lastEventId,i.id)}))},[]),n=d.useCallback(i=>{N.current&&(o(c=>({...c,isConnected:!1,connectionError:i})),C.current<x?(o(c=>({...c,isReconnecting:!0})),v.current=setTimeout(()=>{N.current&&(C.current++,y())},u)):m&&(console.log("Max SSE reconnect attempts reached, falling back to polling"),w()))},[m,x,u]),y=d.useCallback(()=>{if(N.current){j();try{const i={};r&&(i.Authorization=`Bearer ${r}`);const c=new URL(`${S}/api/events/stream`);f.lastEventId>0&&c.searchParams.set("lastEventId",f.lastEventId.toString()),p.current=new EventSource(c.toString()),p.current.onopen=()=>{N.current&&(o(E=>({...E,isConnected:!0,isReconnecting:!1,connectionError:void 0})),C.current=0)},p.current.onmessage=E=>{try{const T=JSON.parse(E.data);b(T)}catch(T){console.error("Failed to parse SSE event:",T)}},p.current.onerror=()=>{n("SSE connection error")},["GameLockEvent","ScoreUpdateEvent","PickSubmittedEvent","AutoPickGeneratedEvent","GameCompletedEvent","LeaderboardUpdateEvent"].forEach(E=>{var T;(T=p.current)==null||T.addEventListener(E,A=>{try{const B=JSON.parse(A.data);b(B)}catch(U){console.error(`Failed to parse ${E} event:`,U)}})})}catch(i){console.error("Failed to create SSE connection:",i),m&&w()}}},[S,r,f.lastEventId,b,n,m,j]),L=d.useCallback(async()=>{if(N.current)try{const i={"Content-Type":"application/json"};r&&(i.Authorization=`Bearer ${r}`);const c=new URL(`${S}/api/events/poll`);c.searchParams.set("lastEventId",f.lastEventId.toString());const $=await fetch(c.toString(),{headers:i});if(!$.ok)throw new Error(`Polling failed: ${$.status}`);const E=await $.json();o(T=>({...T,isConnected:!0,connectionError:void 0})),E.events.forEach(b)}catch(i){console.error("Polling error:",i),o(c=>({...c,isConnected:!1,connectionError:i instanceof Error?i.message:"Unknown polling error"}))}},[S,r,f.lastEventId,b]),w=d.useCallback(()=>{j(),L(),g.current=setInterval(()=>{N.current&&L()},l),o(i=>({...i,isReconnecting:!1}))},[L,l,j]),I=d.useCallback(()=>{"EventSource"in window&&!m?y():w()},[y,w,m]),D=d.useCallback(()=>{j(),o(i=>({...i,isConnected:!1,isReconnecting:!1}))},[j]),t=d.useCallback(()=>{o(i=>({...i,events:[]}))},[]);d.useEffect(()=>(N.current=!0,I(),()=>{N.current=!1,j()}),[I,j]);const h=d.useCallback(i=>f.events.filter(c=>c.type===i),[f.events]),k=d.useCallback(i=>f.events.filter(c=>c.scope===`user:${i}`||c.payload&&"userId"in c.payload&&c.payload.userId===i),[f.events]);return{events:f.events,isConnected:f.isConnected,isReconnecting:f.isReconnecting,lastEventId:f.lastEventId,connectionError:f.connectionError,connect:I,disconnect:D,clearEvents:t,getEventsByType:h,getUserEvents:k}}const te=()=>{try{const s=localStorage.getItem("user");return s?JSON.parse(s).token:void 0}catch{return}},ne=()=>{try{const s=localStorage.getItem("user");return s?JSON.parse(s).id:void 0}catch{return}};function oe(){const[s,a]=d.useState([]),[r,m]=d.useState(!0),[l,u]=d.useState(null),[x,f]=d.useState(1),[o]=d.useState(2025),[p,g]=d.useState(new Map),[v,C]=d.useState("list"),[N]=d.useState(0),[S]=d.useState(!0),j=te(),b=ne(),n=se({userId:b,authToken:j,fallbackToPolling:!0,pollingInterval:1e4}),y=d.useCallback(async()=>{m(!0);try{const t=await z.getGames(x,o);if(t.success&&t.data)try{const h=await z.getGameStatus(x,o);if(h.success&&h.data){const k=t.data.map(i=>{var $;const c=($=h.data)==null?void 0:$.find(E=>E.id===i.id);return{...i,isLocked:(c==null?void 0:c.isLocked)||!1,lockTime:(c==null?void 0:c.lockTime)||i.gameDate,timeToLock:(c==null?void 0:c.timeUntilLock)||0,isLockingSoon:((c==null?void 0:c.timeUntilLock)||0)<=36e5&&!(c!=null&&c.isLocked)}});a(k)}else a(t.data)}catch{a(t.data)}else u(t.error||"Failed to load games")}catch{u("Failed to load games")}finally{m(!1)}},[x,o]),L=d.useCallback(async()=>{if(!(!b||!j))try{const t=await z.getUserPicks(b,x,o,j);if(t.success&&t.data){const h=new Map(t.data.map(k=>[k.gameId,k.teamId]));g(h)}}catch(t){console.error("Failed to fetch user picks:",t)}},[b,j,x,o]),w=d.useCallback(async(t,h)=>{if(!b||!j){u("Please log in to submit picks");return}try{const k=await z.submitPick({gameId:t,teamId:h},j);k.success?(g(i=>new Map(i).set(t,h)),u(null)):u(k.error||"Failed to submit pick")}catch{u("Failed to submit pick")}},[b,j,x,o]);if(d.useEffect(()=>{const t=h=>{switch(h.type){case"GameLockEvent":y();break;case"ScoreUpdateEvent":a(k=>k.map(i=>i.id===h.payload.gameId?{...i,homeScore:h.payload.homeScore,awayScore:h.payload.awayScore}:i));break;case"GameCompletedEvent":a(k=>k.map(i=>i.id===h.payload.gameId?{...i,isCompleted:!0,winnerTeamId:h.payload.winnerId}:i));break;case"AutoPickGeneratedEvent":h.payload.userId===b&&g(k=>new Map(k).set(h.payload.gameId,h.payload.teamPicked.id));break}};n.events.forEach(t)},[n.events,y,b]),d.useEffect(()=>{y(),L()},[y,L]),r)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("div",{className:"h-8 w-32 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-10 w-24 bg-gray-200 rounded animate-pulse"})]}),[...Array(3)].map((t,h)=>e.jsxs("div",{className:"bg-white rounded-lg border p-6 animate-pulse",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"h-4 w-24 bg-gray-200 rounded"}),e.jsx("div",{className:"h-6 w-16 bg-gray-200 rounded-full"})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full"}),e.jsx("div",{className:"h-8 w-8 bg-gray-200 rounded"}),e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full"})]})})]},h))]});if(l)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-red-600 mb-4",children:"Error Loading Games"}),e.jsx("p",{className:"text-gray-600 mb-4",children:l}),e.jsx("button",{onClick:()=>{u(null),y()},className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Retry"})]});const I=s.map(t=>({id:t.id,deadline:new Date(new Date(t.gameDate).getTime()-N*60*1e3),userHasPick:p.has(t.id)})),D={upcoming:s.filter(t=>!t.isCompleted&&!t.isLocked).length,locked:s.filter(t=>!t.isCompleted&&t.isLocked).length,inProgress:s.filter(t=>!t.isCompleted&&t.isLocked&&new Date(t.gameDate)<=new Date).length,final:s.filter(t=>t.isCompleted).length};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b p-4 -m-4 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl sm:text-4xl font-bold",children:"NFL Games"}),e.jsxs("div",{className:"flex items-center space-x-2 sm:hidden",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${n.isConnected?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-xs text-gray-500",children:n.isConnected?"Live":"Offline"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Week:"}),e.jsx("select",{value:x,onChange:t=>f(parseInt(t.target.value)),className:"px-3 py-2 border rounded-lg bg-white text-sm sm:text-base",children:Array.from({length:18},(t,h)=>h+1).map(t=>e.jsxs("option",{value:t,children:["Week ",t]},t))})]}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>C("list"),className:`px-3 py-1 rounded text-xs font-medium transition-colors ${v==="list"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"List"}),e.jsx("button",{onClick:()=>C("compact"),className:`px-3 py-1 rounded text-xs font-medium transition-colors ${v==="compact"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Compact"})]}),e.jsxs("div",{className:"hidden sm:flex items-center space-x-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${n.isConnected?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-xs text-gray-500",children:n.isConnected?"Live":"Offline"})]})]})]})}),b&&I.length>0&&e.jsx(q,{games:I,className:"sticky top-20 z-5"}),s.some(t=>t.isLockingSoon&&!t.isLocked)&&e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("svg",{className:"w-5 h-5 text-orange-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-lg font-semibold text-orange-800",children:"Games Locking Soon!"})]}),e.jsx("div",{className:"space-y-2",children:s.filter(t=>t.isLockingSoon&&!t.isLocked).map(t=>{var h,k;return e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"font-medium",children:[(h=t.awayTeam)==null?void 0:h.abbreviation," @ ",(k=t.homeTeam)==null?void 0:k.abbreviation]}),t.timeToLock&&e.jsxs("span",{className:"text-orange-600 font-mono",children:[Math.floor(t.timeToLock/(1e3*60)),"m remaining"]})]},t.id)})})]}),s.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border",children:[e.jsx("svg",{className:"w-16 h-16 text-gray-300 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"text-lg text-gray-500 mb-2",children:"No games found"}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Week ",x,", ",o]})]}):e.jsx("div",{className:`grid gap-4 ${v==="compact"?"sm:grid-cols-2 lg:grid-cols-3":""}`,children:s.map(t=>e.jsx(ee,{game:t,userHasPick:p.has(t.id),userPickTeamId:p.get(t.id),onPickSubmit:w,lockOffsetMinutes:N,isAutoPickEnabled:S,compactMode:v==="compact",className:"hover:shadow-lg transition-shadow duration-200"},t.id))}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 rounded-lg border p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 00-2-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2H9z"})}),"Week ",x," Summary"]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:s.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Games"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:D.upcoming}),e.jsx("div",{className:"text-sm text-gray-500",children:"Open for Picks"}),e.jsx(R,{status:"upcoming",size:"small",className:"mt-1"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:D.locked}),e.jsx("div",{className:"text-sm text-gray-500",children:"Locked"}),e.jsx(R,{status:"locked",size:"small",className:"mt-1"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:D.final}),e.jsx("div",{className:"text-sm text-gray-500",children:"Final"}),e.jsx(R,{status:"final",size:"small",className:"mt-1"})]})]}),b&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-green-600",children:p.size}),e.jsx("div",{className:"text-xs text-gray-500",children:"Your Picks"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-orange-600",children:s.filter(t=>!t.isCompleted).length-p.size}),e.jsx("div",{className:"text-xs text-gray-500",children:"Remaining"})]}),e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsxs("div",{className:"text-lg font-semibold text-blue-600",children:[s.length>0?Math.round(p.size/s.length*100):0,"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Complete"})]})]})})]})]})}export{oe as GamesPage};

import{j as e}from"./index-BQMGdd4M.js";import{r as o}from"./vendor-DLdglawL.js";import{A as P}from"./api-9Tv9JkjW.js";const D=s=>{const i=typeof s=="string"?new Date(s):s;return Math.max(0,Math.floor((i.getTime()-Date.now())/1e3))},B=s=>{const i=Math.floor(s/3600),a=Math.floor(s%3600/60),d=s%60;return i>0?[i,a,d].map(c=>c<10?`0${c}`:c).join(":"):[a,d].map(c=>c<10?`0${c}`:c).join(":")},G=s=>{const i=Math.floor(s/3600),a=Math.floor(s%3600/60);return i>0?`${i}h ${a}m`:`${a}m`},F=(s,i=0)=>{const a=typeof s=="string"?new Date(s):s,d=new Date(a.getTime()-i*60*1e3);return Date.now()>=d.getTime()},H=(s,i=0)=>{const a=typeof s=="string"?new Date(s):s;return new Date(a.getTime()-i*60*1e3)},O=s=>(typeof s=="string"?new Date(s):s).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",timeZoneName:"short"}),V=(s,i=!1)=>{const a=typeof s=="string"?new Date(s):s,d=a.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});if(i){const c=O(a);return`${d} at ${c}`}return d},Y=(s,i=0)=>F(s,i)?"This game is locked for picks. Submission deadline has passed.":null,U=({targetTime:s,mode:i="detailed",onFinish:a,className:d="",showIcon:c=!1,urgentThreshold:u=300})=>{const[x,h]=o.useState(D(s)),[m,p]=o.useState(!1),g=o.useCallback(()=>{const r=D(s);h(r),r<=0&&!m&&(p(!0),a==null||a())},[s,a,m]);o.useEffect(()=>{g();const r=setInterval(g,1e3);return()=>clearInterval(r)},[g]);const b=x>0&&x<=u,E=x<=0,y=()=>{if(E)return i==="minimal"?"0:00":"Expired";switch(i){case"compact":return G(x);case"minimal":return B(x);case"detailed":default:return B(x)}},L=()=>{let r="font-mono font-medium transition-colors duration-300";switch(E?r+=" text-red-600":b?r+=" text-orange-600 animate-pulse":r+=" text-gray-700",i){case"minimal":r+=" text-sm";break;case"compact":r+=" text-base";break;case"detailed":default:r+=" text-lg";break}return r},C=()=>e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),S=()=>{if(E)return"Time expired";const r=Math.floor(x/3600),v=Math.floor(x%3600/60),w=x%60;let N="";return r>0&&(N+=`${r} hour${r!==1?"s":""} `),v>0&&(N+=`${v} minute${v!==1?"s":""} `),r===0&&(N+=`${w} second${w!==1?"s":""} `),`${N.trim()} remaining`};return e.jsxs("div",{className:`inline-flex items-center ${d}`,role:"timer","aria-live":"assertive","aria-atomic":"true","aria-label":S(),children:[c&&e.jsx(C,{}),e.jsx("span",{className:L(),children:y()}),i==="detailed"&&!E&&e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:b?"remaining!":"left"})]})},_={upcoming:{label:"OPEN",bgColor:"bg-blue-100",textColor:"text-blue-800",borderColor:"border-blue-200",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),description:"Picks are still open"},locked:{label:"LOCKED",bgColor:"bg-gray-100",textColor:"text-gray-800",borderColor:"border-gray-300",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),description:"No more picks allowed"},inProgress:{label:"LIVE",bgColor:"bg-orange-100",textColor:"text-orange-800",borderColor:"border-orange-200",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-7 4h12l-1 1H7l-1-1z"})}),description:"Game in progress"},final:{label:"FINAL",bgColor:"bg-green-100",textColor:"text-green-800",borderColor:"border-green-200",icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),description:"Game completed"}},J={small:{container:"px-2 py-1 text-xs",icon:"w-3 h-3"},medium:{container:"px-3 py-1.5 text-sm",icon:"w-4 h-4"},large:{container:"px-4 py-2 text-base",icon:"w-5 h-5"}},z=({status:s,size:i="medium",showIcon:a=!1,className:d=""})=>{const c=_[s],u=J[i];return e.jsxs("span",{className:`
        inline-flex items-center gap-1.5 rounded-full font-medium border transition-all duration-200
        ${c.bgColor} ${c.textColor} ${c.borderColor}
        ${u.container}
        ${d}
      `,role:"status","aria-label":c.description,title:c.description,children:[a&&e.jsx("span",{className:u.icon,"aria-hidden":"true",children:c.icon}),e.jsx("span",{children:c.label})]})},K=(s,i,a=0)=>{const d=typeof s=="string"?new Date(s):s,c=Date.now(),u=d.getTime(),x=u-a*60*1e3;return i?"final":c>=u?"inProgress":c>=x?"locked":"upcoming"},Z=({deadline:s,gameId:i,userHasPick:a=!1,isAutoPickEnabled:d=!1,onDeadlineReached:c,className:u="",compact:x=!1})=>{const[h,m]=o.useState(D(s)<=0);return o.useEffect(()=>{const p=()=>{D(s)<=0&&!h&&(m(!0),c==null||c(i))};p();const g=setInterval(p,1e3);return()=>clearInterval(g)},[s,i,h,c]),Y(s),h?a?e.jsx("div",{className:`flex items-center space-x-2 ${u}`,children:e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm font-medium",children:"Pick submitted"})]})}):d?e.jsx("div",{className:`flex items-center space-x-2 ${u}`,children:e.jsxs("div",{className:"flex items-center text-orange-600",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm font-medium",children:"Auto-pick will be assigned"})]})}):e.jsx("div",{className:`flex items-center space-x-2 ${u}`,children:e.jsxs("div",{className:"flex items-center text-red-600",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.664-.833-2.464 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"text-sm font-medium",children:"Deadline passed"})]})}):a?e.jsxs("div",{className:`flex items-center space-x-2 ${u}`,children:[e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm font-medium",children:"Pick submitted"})]}),!x&&e.jsx("div",{className:"text-xs text-gray-500",children:"Can change until deadline"})]}):e.jsxs("div",{className:`space-y-2 ${u}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`font-medium ${x?"text-sm":"text-base"} text-gray-700`,children:"Pick deadline"}),e.jsx(U,{targetTime:s,mode:x?"compact":"detailed",urgentThreshold:300,className:"bg-orange-50 px-2 py-1 rounded"})]}),!x&&e.jsx("div",{className:"text-xs text-gray-500",children:d?"Submit your pick or one will be assigned automatically":"Submit your pick before time expires"})]})},q=({games:s,onDeadlineReached:i,className:a})=>{const d=s.filter(u=>D(u.deadline)>0),c=d.reduce((u,x)=>new Date(x.deadline).getTime()<u.getTime()?new Date(x.deadline):u,new Date(Date.now()+7*24*60*60*1e3));return d.length===0?e.jsx("div",{className:`text-center p-4 text-gray-500 ${a}`,children:"All pick deadlines have passed"}):e.jsxs("div",{className:`bg-gradient-to-r from-blue-50 to-orange-50 p-4 rounded-lg ${a}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Next deadline in:"}),e.jsx(U,{targetTime:c,mode:"compact",urgentThreshold:900})]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[d.length," game",d.length!==1?"s":""," with pending picks"]})]})},Q=(s,i=!0)=>{const a=Math.abs(s)/100;return`${s>0?"+":"-"}${a.toFixed(1)}`},X=s=>(Math.abs(s)/100).toFixed(1),ee=({game:s,userHasPick:i=!1,userPickTeamId:a,onPickSubmit:d,onViewPick:c,className:u="",lockOffsetMinutes:x=0,isAutoPickEnabled:h=!1,compactMode:m=!1})=>{var S;const p="isLocked"in s,g=p?s:null,b=K(s.gameDate,s.isCompleted,x),E=g!=null&&g.lockTime?new Date(g.lockTime):H(s.gameDate,x),y=p?!(g!=null&&g.isLocked)&&!s.isCompleted:b==="upcoming",L=({team:r,isHome:v,score:w})=>e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`
        ${m?"w-12 h-12":"w-16 h-16"} 
        bg-primary/10 rounded-full flex items-center justify-center mb-2 overflow-hidden
        ${a===(r==null?void 0:r.id)?"ring-2 ring-blue-500 bg-blue-50":""}
      `,children:[r!=null&&r.logo?e.jsx("img",{src:r.logo,alt:`${r.name} logo`,className:`${m?"w-8 h-8":"w-12 h-12"} object-contain`,onError:N=>{N.currentTarget.style.display="none",N.currentTarget.nextElementSibling.style.display="block"}}):null,e.jsx("span",{className:`font-bold ${m?"text-sm":"text-lg"} text-primary ${r!=null&&r.logo?"hidden":""}`,style:{display:r!=null&&r.logo?"none":"block"},children:(r==null?void 0:r.abbreviation)||(v?"HOME":"AWAY")})]}),e.jsx("div",{className:`font-semibold ${m?"text-sm":"text-base"}`,children:m?r==null?void 0:r.abbreviation:(r==null?void 0:r.name)||`${v?"Home":"Away"} Team`}),!m&&e.jsx("div",{className:"text-sm text-muted-foreground",children:r==null?void 0:r.abbreviation}),w!=null&&e.jsx("div",{className:`${m?"text-xl":"text-2xl"} font-bold mt-2`,children:w}),a===(r==null?void 0:r.id)&&e.jsx("div",{className:"mt-1",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800",children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Your Pick"]})})]}),C=()=>!y||!d?null:e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>d(s.id,s.awayTeam.id),disabled:a===s.awayTeam.id,className:`
            px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 touch-manipulation
            ${a===s.awayTeam.id?"bg-blue-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-blue-50 hover:text-blue-700 active:scale-95"}
          `,children:["Pick ",s.awayTeam.abbreviation]}),e.jsxs("button",{onClick:()=>d(s.id,s.homeTeam.id),disabled:a===s.homeTeam.id,className:`
            px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200 touch-manipulation
            ${a===s.homeTeam.id?"bg-blue-500 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-blue-50 hover:text-blue-700 active:scale-95"}
          `,children:["Pick ",s.homeTeam.abbreviation]})]});return e.jsxs("div",{className:`
      bg-white rounded-lg border shadow-sm hover:shadow-md transition-all duration-200
      ${m?"p-4":"p-6"}
      ${u}
    `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:`text-muted-foreground ${m?"text-xs":"text-sm"}`,children:["Game #",s.id," â€¢ Week ",s.week]}),!m&&e.jsx("div",{className:"text-sm font-medium text-gray-700",children:V(s.gameDate,!0)})]}),e.jsxs("div",{className:"flex flex-col items-end space-y-2",children:[e.jsx(z,{status:b,size:m?"small":"medium",showIcon:!m}),y&&e.jsx(U,{targetTime:(g==null?void 0:g.lockTime)||s.gameDate,mode:m?"compact":"detailed",className:"text-right"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(L,{team:s.awayTeam,isHome:!1,score:s.awayScore}),e.jsx("div",{className:`${m?"text-xl":"text-2xl"} font-bold text-muted-foreground`,children:"@"}),e.jsx(L,{team:s.homeTeam,isHome:!0,score:s.homeScore})]}),(s.homeSpread||s.overUnder)&&!m&&e.jsxs("div",{className:"flex justify-center space-x-4 mb-4 text-sm text-gray-600",children:[s.homeSpread&&e.jsxs("div",{children:[(S=s.homeTeam)==null?void 0:S.abbreviation," ",Q(s.homeSpread)]}),s.overUnder&&e.jsxs("div",{children:["O/U: ",X(s.overUnder)]})]}),b==="upcoming"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(Z,{deadline:E,gameId:s.id,userHasPick:i,isAutoPickEnabled:h,compact:m}),e.jsx(C,{})]}),(b==="locked"||b==="inProgress"||b==="final")&&i&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-green-700",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("span",{className:"text-sm font-medium",children:["Pick submitted: ",a===s.homeTeam.id?s.homeTeam.name:s.awayTeam.name]})]}),c&&e.jsx("button",{onClick:()=>c(s.id),className:"text-green-600 text-sm hover:text-green-800 transition-colors",children:"View"})]})}),b==="locked"&&!i&&h&&e.jsx("div",{className:"mt-4 p-3 bg-orange-50 rounded-lg border border-orange-200",children:e.jsxs("div",{className:"flex items-center text-orange-700",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"text-sm",children:"Auto-pick will be assigned"})]})})]})};function se(s={}){const{userId:i,authToken:a,fallbackToPolling:d=!0,pollingInterval:c=5e3,reconnectInterval:u=3e3,maxReconnectAttempts:x=5}=s,[h,m]=o.useState({events:[],isConnected:!1,isReconnecting:!1,lastEventId:0}),p=o.useRef(null),g=o.useRef(null),b=o.useRef(null),E=o.useRef(0),y=o.useRef(!0),L="https://nfl-pickem-app-production.cybermattlee-llc.workers.dev",C=o.useCallback(()=>{p.current&&(p.current.close(),p.current=null),g.current&&(clearTimeout(g.current),g.current=null),b.current&&(clearTimeout(b.current),b.current=null)},[]),S=o.useCallback(n=>{y.current&&m(l=>({...l,events:[...l.events,n],lastEventId:Math.max(l.lastEventId,n.id)}))},[]),r=o.useCallback(n=>{y.current&&(m(l=>({...l,isConnected:!1,connectionError:n})),E.current<x?(m(l=>({...l,isReconnecting:!0})),b.current=setTimeout(()=>{y.current&&(E.current++,v())},u)):d&&(console.log("Max SSE reconnect attempts reached, falling back to polling"),N()))},[d,x,u]),v=o.useCallback(()=>{if(y.current){C();try{const n={};a&&(n.Authorization=`Bearer ${a}`);const l=new URL(`${L}/api/events/stream`);h.lastEventId>0&&l.searchParams.set("lastEventId",h.lastEventId.toString()),p.current=new EventSource(l.toString()),p.current.onopen=()=>{y.current&&(m(f=>({...f,isConnected:!0,isReconnecting:!1,connectionError:void 0})),E.current=0)},p.current.onmessage=f=>{try{const k=JSON.parse(f.data);S(k)}catch(k){console.error("Failed to parse SSE event:",k)}},p.current.onerror=()=>{r("SSE connection error")},["GameLockEvent","ScoreUpdateEvent","PickSubmittedEvent","AutoPickGeneratedEvent","GameCompletedEvent","LeaderboardUpdateEvent"].forEach(f=>{var k;(k=p.current)==null||k.addEventListener(f,M=>{try{const A=JSON.parse(M.data);S(A)}catch(W){console.error(`Failed to parse ${f} event:`,W)}})})}catch(n){console.error("Failed to create SSE connection:",n),d&&N()}}},[L,a,h.lastEventId,S,r,d,C]),w=o.useCallback(async()=>{if(y.current)try{const n={"Content-Type":"application/json"};a&&(n.Authorization=`Bearer ${a}`);const l=new URL(`${L}/api/events/poll`);l.searchParams.set("lastEventId",h.lastEventId.toString());const j=await fetch(l.toString(),{headers:n});if(!j.ok)throw new Error(`Polling failed: ${j.status}`);const f=await j.json();m(k=>({...k,isConnected:!0,connectionError:void 0})),f.events.forEach(S)}catch(n){console.error("Polling error:",n),m(l=>({...l,isConnected:!1,connectionError:n instanceof Error?n.message:"Unknown polling error"}))}},[L,a,h.lastEventId,S]),N=o.useCallback(()=>{C(),w(),g.current=setInterval(()=>{y.current&&w()},c),m(n=>({...n,isReconnecting:!1}))},[w,c,C]),T=o.useCallback(()=>{"EventSource"in window&&!d?v():N()},[v,N,d]),R=o.useCallback(()=>{C(),m(n=>({...n,isConnected:!1,isReconnecting:!1}))},[C]),I=o.useCallback(()=>{m(n=>({...n,events:[]}))},[]);o.useEffect(()=>(y.current=!0,T(),()=>{y.current=!1,C()}),[T,C]);const $=o.useCallback(n=>h.events.filter(l=>l.type===n),[h.events]),t=o.useCallback(n=>h.events.filter(l=>l.scope===`user:${n}`||l.payload&&"userId"in l.payload&&l.payload.userId===n),[h.events]);return{events:h.events,isConnected:h.isConnected,isReconnecting:h.isReconnecting,lastEventId:h.lastEventId,connectionError:h.connectionError,connect:T,disconnect:R,clearEvents:I,getEventsByType:$,getUserEvents:t}}const te=[{id:"dad-user-id",name:"Dad"},{id:"mom-user-id",name:"Mom"},{id:"twobow-user-id",name:"TwoBow"},{id:"rocky-user-id",name:"RockyDaRock"}];function ie(){const[s,i]=o.useState([]),[a,d]=o.useState(!0),[c,u]=o.useState(null),[x,h]=o.useState(1),[m]=o.useState(2025),[p,g]=o.useState(new Map),[b,E]=o.useState("list"),[y]=o.useState(0),[L]=o.useState(!0),[C,S]=o.useState(""),r=void 0,v=C||void 0,w=se({userId:v,authToken:r,fallbackToPolling:!0,pollingInterval:1e4}),N=o.useCallback(async()=>{d(!0);try{const t=await P.getGames(x,m);if(t.success&&t.data)try{const n=await P.getGameStatus(x,m);if(n.success&&n.data){const l=t.data.map(j=>{var k;const f=(k=n.data)==null?void 0:k.find(M=>M.id===j.id);return{...j,isLocked:(f==null?void 0:f.isLocked)||!1,lockTime:(f==null?void 0:f.lockTime)||j.gameDate,timeToLock:(f==null?void 0:f.timeUntilLock)||0,isLockingSoon:((f==null?void 0:f.timeUntilLock)||0)<=36e5&&!(f!=null&&f.isLocked)}});i(l)}else i(t.data)}catch{i(t.data)}else u(t.error||"Failed to load games")}catch{u("Failed to load games")}finally{d(!1)}},[x,m]),T=o.useCallback(async()=>{if(v)try{const t=await P.get("/api/picks");if(t.success&&t.data){const n=t.data.picks||[],l=s.map(k=>k.id),j=n.filter(k=>k.userId===v&&l.includes(k.gameId)),f=new Map(j.map(k=>[k.gameId,k.teamId]));g(f)}}catch(t){console.error("Failed to fetch user picks:",t)}},[v,s]),R=o.useCallback(async(t,n)=>{if(!v){u("Please select a user to submit picks");return}try{const l=await P.submitPick({gameId:t,teamId:n,userId:v},"");l.success?(g(j=>new Map(j).set(t,n)),u(null)):u(l.error||"Failed to submit pick")}catch{u("Failed to submit pick")}},[v]);if(o.useEffect(()=>{const t=n=>{switch(n.type){case"GameLockEvent":N();break;case"ScoreUpdateEvent":i(l=>l.map(j=>j.id===n.payload.gameId?{...j,homeScore:n.payload.homeScore,awayScore:n.payload.awayScore}:j));break;case"GameCompletedEvent":i(l=>l.map(j=>j.id===n.payload.gameId?{...j,isCompleted:!0,winnerTeamId:n.payload.winnerId}:j));break;case"AutoPickGeneratedEvent":n.payload.userId===v&&g(l=>new Map(l).set(n.payload.gameId,n.payload.teamPicked.id));break}};w.events.forEach(t)},[w.events,N,v]),o.useEffect(()=>{N()},[N]),o.useEffect(()=>{T()},[T,C]),a)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("div",{className:"h-8 w-32 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-10 w-24 bg-gray-200 rounded animate-pulse"})]}),[...Array(3)].map((t,n)=>e.jsxs("div",{className:"bg-white rounded-lg border p-6 animate-pulse",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"h-4 w-24 bg-gray-200 rounded"}),e.jsx("div",{className:"h-6 w-16 bg-gray-200 rounded-full"})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full"}),e.jsx("div",{className:"h-8 w-8 bg-gray-200 rounded"}),e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-full"})]})})]},n))]});if(c)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-red-600 mb-4",children:"Error Loading Games"}),e.jsx("p",{className:"text-gray-600 mb-4",children:c}),e.jsx("button",{onClick:()=>{u(null),N()},className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Retry"})]});const I=s.map(t=>({id:t.id,deadline:new Date(new Date(t.gameDate).getTime()-y*60*1e3),userHasPick:p.has(t.id)})),$={upcoming:s.filter(t=>!t.isCompleted&&!t.isLocked).length,locked:s.filter(t=>!t.isCompleted&&t.isLocked).length,inProgress:s.filter(t=>!t.isCompleted&&t.isLocked&&new Date(t.gameDate)<=new Date).length,final:s.filter(t=>t.isCompleted).length};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white/95 backdrop-blur-sm border-b p-4 -m-4 mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl sm:text-4xl font-bold",children:"NFL Games"}),e.jsxs("div",{className:"flex items-center space-x-2 sm:hidden",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${w.isConnected?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-xs text-gray-500",children:w.isConnected?"Live":"Offline"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"User:"}),e.jsxs("select",{value:C,onChange:t=>S(t.target.value),className:"px-3 py-2 border rounded-lg bg-white text-sm sm:text-base",children:[e.jsx("option",{value:"",children:"Select user..."}),te.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Week:"}),e.jsx("select",{value:x,onChange:t=>h(parseInt(t.target.value)),className:"px-3 py-2 border rounded-lg bg-white text-sm sm:text-base",children:Array.from({length:18},(t,n)=>n+1).map(t=>e.jsxs("option",{value:t,children:["Week ",t]},t))})]}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>E("list"),className:`px-3 py-1 rounded text-xs font-medium transition-colors ${b==="list"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"List"}),e.jsx("button",{onClick:()=>E("compact"),className:`px-3 py-1 rounded text-xs font-medium transition-colors ${b==="compact"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Compact"})]}),e.jsxs("div",{className:"hidden sm:flex items-center space-x-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${w.isConnected?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-xs text-gray-500",children:w.isConnected?"Live":"Offline"})]})]})]})}),v&&I.length>0&&e.jsx(q,{games:I,className:"sticky top-20 z-5"}),s.some(t=>t.isLockingSoon&&!t.isLocked)&&e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("svg",{className:"w-5 h-5 text-orange-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"text-lg font-semibold text-orange-800",children:"Games Locking Soon!"})]}),e.jsx("div",{className:"space-y-2",children:s.filter(t=>t.isLockingSoon&&!t.isLocked).map(t=>{var n,l;return e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"font-medium",children:[(n=t.awayTeam)==null?void 0:n.abbreviation," @ ",(l=t.homeTeam)==null?void 0:l.abbreviation]}),t.timeToLock&&e.jsxs("span",{className:"text-orange-600 font-mono",children:[Math.floor(t.timeToLock/(1e3*60)),"m remaining"]})]},t.id)})})]}),s.length===0?e.jsxs("div",{className:"text-center py-12 bg-white rounded-lg border",children:[e.jsx("svg",{className:"w-16 h-16 text-gray-300 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"text-lg text-gray-500 mb-2",children:"No games found"}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Week ",x,", ",m]})]}):e.jsx("div",{className:`grid gap-4 ${b==="compact"?"sm:grid-cols-2 lg:grid-cols-3":""}`,children:s.map(t=>e.jsx(ee,{game:t,userHasPick:p.has(t.id),userPickTeamId:p.get(t.id),onPickSubmit:R,lockOffsetMinutes:y,isAutoPickEnabled:L,compactMode:b==="compact",className:"hover:shadow-lg transition-shadow duration-200"},t.id))}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 rounded-lg border p-6",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 00-2-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2H9z"})}),"Week ",x," Summary"]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:s.length}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total Games"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:$.upcoming}),e.jsx("div",{className:"text-sm text-gray-500",children:"Open for Picks"}),e.jsx(z,{status:"upcoming",size:"small",className:"mt-1"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:$.locked}),e.jsx("div",{className:"text-sm text-gray-500",children:"Locked"}),e.jsx(z,{status:"locked",size:"small",className:"mt-1"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:$.final}),e.jsx("div",{className:"text-sm text-gray-500",children:"Final"}),e.jsx(z,{status:"final",size:"small",className:"mt-1"})]})]}),v&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-green-600",children:p.size}),e.jsx("div",{className:"text-xs text-gray-500",children:"Your Picks"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold text-orange-600",children:s.filter(t=>!t.isCompleted).length-p.size}),e.jsx("div",{className:"text-xs text-gray-500",children:"Remaining"})]}),e.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[e.jsxs("div",{className:"text-lg font-semibold text-blue-600",children:[s.length>0?Math.round(p.size/s.length*100):0,"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Complete"})]})]})})]})]})}export{ie as GamesPage};
